# Автоматическое обновление банковской информации при синхронизации

## Описание изменений

Добавлено автоматическое обновление банковской информации (название банка и БИК) в транзакциях после синхронизации с 1С.

## Что было изменено

### 1. Синхронизация банковских транзакций (`_sync_bank_transactions_async`)

**Файл:** `backend/app/services/async_sync_service.py`

**Изменения:**
- После импорта транзакций автоматически вызывается `update_transactions_bank_info()`
- Обновляется поле `our_bank_name` и `our_bank_bik` в транзакциях
- Статистика обновления банков добавляется в результат:
  - `bank_info_updated` - количество обновленных транзакций
  - `bank_info_errors` - количество ошибок

### 2. Полная синхронизация (`_sync_full_async`)

**Изменения:**
- Аналогичное обновление банковской информации после импорта всех данных
- Статистика включена в финальное сообщение

## Как это работает

1. **Импорт транзакций из 1С** - создаются/обновляются транзакции
2. **Автоматическое обновление банков** - вызывается `update_transactions_bank_info()`
   - Загружаются все банковские счета из 1С (справочник `Catalog_БанковскиеСчетаОрганизаций`)
   - Для каждой транзакции без банковской информации:
     - Поиск счёта по `account_number`
     - Обновление `our_bank_name` и `our_bank_bik` из справочника
3. **Отображение результата** - количество обновленных банков в сообщении о завершении

## Примеры результатов

### До изменений
```json
{
  "success": true,
  "message": "Импорт завершён: 155 создано, 0 обновлено, 0 пропущено",
  "total_fetched": 155,
  "total_created": 155,
  "total_updated": 0,
  "total_skipped": 0
}
```

### После изменений
```json
{
  "success": true,
  "message": "Импорт завершён: 155 создано, 0 обновлено, 0 пропущено. Обновлено банков: 155",
  "total_fetched": 155,
  "total_created": 155,
  "total_updated": 0,
  "total_skipped": 0,
  "bank_info_updated": 155,
  "bank_info_errors": 0
}
```

## Преимущества

✅ **Автоматизация** - не нужно отдельно синхронизировать банки
✅ **Полнота данных** - информация о банках всегда актуальна
✅ **Удобство** - все в одном запросе
✅ **Прозрачность** - статистика обновления в результатах

## Затронутые endpoints

- `POST /api/v1/sync/bank-transactions` - синхронизация транзакций
- `POST /api/v1/sync/full` - полная синхронизация

## Логи

При обновлении банковской информации в логах появятся записи:

```
INFO: Bank info update: {'updated': 155, 'errors': 0, 'total': 155}
INFO: Loaded 42 bank accounts from 1C
INFO: Bank information update completed: updated=155, errors=0, total=155
```

## Зависимости

- `app.services.bank_info_updater.update_transactions_bank_info()` - основной сервис
- OData 1C Client - для загрузки справочника банковских счетов
